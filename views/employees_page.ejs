<!-- <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
        <div class="col-sm-6">
            <h1>Employees</h1>
        </div>
        <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
            <!-- <li class="breadcrumb-item"><a href="#">Home</a></li>
            <li class="breadcrumb-item active">Employees</li> -->
                <div class="col text-right">
                    <button type="button" class="btn btn-sm btn-success" id="new-employee-button">New Employee</button>
                    <button type="button" class="btn btn-sm btn-danger" id="cancel-button" hidden>Cancel</button>
                    <button type="button" class="btn btn-sm btn-warning" id="return-button" hidden>return</button>
                </div>
            </ol>
        </div>
        </div>
    </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
        <div id="employees-card" class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                    <!-- <div class="card-header">
                        <h3 class="card-title">DataTable with default features</h3>
                    </div> -->
                    <!-- /.card-header -->
                    <div class="card-body">
                        <table id="employees-table" class="table table-sm table-bordered table-striped" width="100%" cellspacing="0">
                        <thead>
                        <tr>
                            <th>Employee ID</th>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Department</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                            <% employees.forEach(employee => { %>
                            <tr data-id="<%- employee['id'] %>">
                                <td><%- employee['id'] %></td>
                                <td><%- employee['name'] %></td>
                                <td><%- employee['position_name'] %></td>
                                <td><%- employee['department_name'] %></td>
                                <td class="text-center text-break">
                                    <!-- Detail -->
                                    <a href="#" class="m-1" onclick="showEmpoyeeDetailCard()">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="green" d="M15 11h7v2h-7zm1 4h6v2h-6zm-2-8h8v2h-8zM4 19h10v-1c0-2.757-2.243-5-5-5H7c-2.757 0-5 2.243-5 5v1zm4-7c1.995 0 3.5-1.505 3.5-3.5S9.995 5 8 5S4.5 6.505 4.5 8.5S6.005 12 8 12"/></svg>
                                    </a>
                                    <!-- Edit -->
                                    <a href="#" class="m-1" onclick="editEmployee()">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 32 32"><path fill="orange" d="M25 4.031c-.766 0-1.516.297-2.094.875L13 14.781l-.219.219l-.062.313l-.688 3.5l-.312 1.468l1.469-.312l3.5-.688l.312-.062l.219-.219l9.875-9.906A2.968 2.968 0 0 0 25 4.03zm0 1.938c.234 0 .465.12.688.343c.445.446.445.93 0 1.375L16 17.376l-1.719.344l.344-1.719l9.688-9.688c.222-.222.453-.343.687-.343zM4 8v20h20V14.812l-2 2V26H6V10h9.188l2-2z"/></svg>
                                    </a>
                                    <!-- Delete -->
                                    <a href="#" class="m-1" onclick="deleteEmployee(`<%- employee['id'] %>`)">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="red" d="M7 21q-.825 0-1.412-.587T5 19V6H4V4h5V3h6v1h5v2h-1v13q0 .825-.587 1.413T17 21zm2-4h2V8H9zm4 0h2V8h-2z"/></svg>
                                    </a>
                                </td>
                            </tr>
                            <% }); %>
                            </tbody>                            
                        </table>
                    </div>
                    <script>
                        $(function () {
                            $("#employees-table").DataTable({
                                "responsive": true,
                                "lengthChange": true, // Setel menjadi true untuk menampilkan dropdown "Show entries"
                                "autoWidth": false,
                                "buttons": [
                                  "copy", 
                                  "csv", 
                                  "excel", 
                                  "pdf", 
                                  "print",
                                  // "colvis"
                                ],
                                "lengthMenu": [[10, 25, 50, 100], [10, 25, 50, 100]], // Atur opsi panjang halaman yang diinginkan
                                "paging": true,
                                "ordering": true,
                                "info": true,
                            }).buttons().container().appendTo('#employees-table_wrapper .col-md-6:eq(0)');
                        });
                        function deleteEmployee(id) {
                            Swal.fire({
                                title: "are you sure wanna deleted it?",
                                text: "You won't be able to revert this!",
                                icon: "warning",
                                showCancelButton: true,
                                confirmButtonColor: "#3085d6",
                                cancelButtonColor: "#d33",
                                confirmButtonText: "Yes!"
                            }).then(results => {
                                Swal.fire({
                                    title: "Loading!",
                                    timer: 3800,
                                    timeProgressBar: true,
                                    didOpen: ()=>{
                                        Swal.showLoading();
                                    }
                                });
                                if (results.isConfirmed) {
                                    $.ajax({
                                        url: `/employee/${id}`,
                                        method: 'DELETE',
                                        dataType: 'json',
                                        success: function(results) {
                                            if (results.status !== 200) {
                                                ErrorNotif(results.message);
                                                return 0;
                                            }
                                            setTimeout(() => {
                                                OkeNotif(results.message);
                                                $(`tr[data-id="${id}"]`).remove();
                                                if ($("#employees-table tbody tr").length === 0) {
                                                    $("#employees-table tbody").append(`
                                                    <tr class="odd"><td valign="top" colspan="5" class="dataTables_empty">No data available in table</td></tr>
                                                    `)
                                                }
                                            }, 4000);
                                        },
                                        error: function(xhr, status, error) {
                                            WarningNotif(`${status} ${error}`);
                                            console.log(error);
                                        }
                                    });
                                    return 0;
                                }
                            })
                        }               
                    </script>
                    <!-- /.card-body -->
                </div>
                <!-- /.card -->
              </div>
            </div>
        </div>
        <div id="employee-form-card" class="container-fluid" hidden>
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <form>
                                <div class="form-group">
                                    <label for="id-number">ID Number <small style="color: red;">*Required</small></label>
                                    <input type="text" class="form-control" id="id-number-form" name="id-number">
                                </div>
                                <div class="form-group">
                                    <label for="fullname">Full Name <small style="color: red;">*Required</small></label>
                                    <input type="text" class="form-control" id="fullname-form" name="fullname">
                                </div>
                                <div class="form-group">
                                    <label for="title">Title</label>
                                    <input type="text" class="form-control" id="title-form" name="title">
                                </div>
                                <div class="form-group">
                                    <label for="born-place">Born Place</label>
                                    <input type="text" class="form-control" id="born-place-form" name="born-place">
                                </div>
                                <div class="form-group">
                                    <label for="birthdate">Birthdate</label>
                                    <input type="date" class="form-control" id="birth-date-form" name="birthdate">
                                </div>
                                <div class="form-group">
                                    <label for="id-card-photo">ID Card Photo</label>
                                    <input type="file" class="form-control-file" id="id-card-photo-form" name="id-card-photo">
                                </div>
                                <div class="form-group">
                                    <label for="photo">Photo</label>
                                    <input type="file" class="form-control-file" id="photo-form" name="photo">
                                </div>
                                <div class="form-group">
                                    <label for="address">Address</label>
                                    <textarea class="form-control" id="address-form" name="address" rows="3"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="department">Department</label>
                                    <select class="form-control" style="width: 100%;">
                                        <option selected="selected">Alabama</option>
                                        <option>Alaska</option>
                                        <option>California</option>
                                        <option>Delaware</option>
                                        <option>Tennessee</option>
                                        <option>Texas</option>
                                        <option>Washington</option>
                                    </select>                    
                                </div>
                                <div class="form-group">
                                    <label for="position">Position</label>
                                    <select class="form-control" style="width: 100%;">
                                        <option selected="selected" disabled>Select Position</option>
                                        <option>Alaska</option>
                                        <option>California</option>
                                        <option>Delaware</option>
                                        <option>Tennessee</option>
                                        <option>Texas</option>
                                        <option>Washington</option>
                                    </select>                    
                                </div>
                                <div id="button-submit-form">
                                    <!-- Button Will be creating is here -->
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="employee-detail-card" class="container-fluid" hidden>
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header align-items-center">
                            <div><b>Employee Information</b></div>
                        </div>
                        <div class="card-body">
                            <table class="table table-sm table-bordered" width="100%" cellspacing="0">
                                <tbody>
                                <tr>
                                    <td>Employee ID</td>
                                    <td id="employee-id-column"></td>
                                </tr>
                                <tr>
                                    <td>ID Number</td>
                                    <td id="id-number-column"></td>
                                </tr>
                                <tr>
                                    <td>Name</td>
                                    <td id="name-column"></td>
                                </tr>
                                <tr>
                                    <td>Title</td>
                                    <td id="title-column"></td>
                                </tr>
                                <tr>
                                    <td>Place/Date of Birth</td>
                                    <td><span id="birth-place-column"></span><span id="birth-date-column"></span></td>
                                </tr>
                                <tr>
                                    <td>Address</td>
                                    <td id="address-column"></td>
                                </tr>
                                <tr>
                                    <td>Photo</td>
                                    <td><a href="#">view</a></td>
                                </tr>
                                <tr>
                                    <td>ID Card Photo</td>
                                    <td><a href="#">view</a></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
<script>
    // Cards
    const employeesCard = document.getElementById("employees-card");
    const employeeFormCard = document.getElementById("employee-form-card");
    const employeeDetailCard = document.getElementById("employee-detail-card");
    // Button Handler for cards
    const newEmployeeButton = document.getElementById("new-employee-button");
    const cancelButton = document.getElementById("cancel-button");
    const returnButton = document.getElementById("return-button");
    // Button Handler for The Forms
    const buttonSubmitForm = document.getElementById("button-submit-form");
    // Employee Form Elements
    const idNumberForm = document.getElementById("id-number-form");
    const fullnameForm = document.getElementById("fullname-form");
    const titleForm = document.getElementById("title-form");
    const bornPlaceForm = document.getElementById("born-place-form");
    const birthDateForm = document.getElementById("birth-date-form");
    const idCardPhotoForm = document.getElementById("id-card-photo-form");
    const photoForm = document.getElementById("photo-form");
    const addressForm = document.getElementById("address-form");
    const clearForm = () => {
        idNumberForm.value = null;
        fullnameForm.value = null;
        titleForm.value = null;
        bornPlaceForm.value = null;
        birthDateForm.value = null;
        idCardPhotoForm.value = null;
        photoForm.value = null;
        addressForm.value = null;
    }
    // Employee Detail Elements
    const employeeIdColumn = document.getElementById("employee-id-column");
    const idNumberColumn = document.getElementById("id-number-column");
    const nameColumn = document.getElementById("name-column");
    const titleColumn = document.getElementById("title-column");
    const birthPlaceColumn = document.getElementById("birth-place-column");
    const birthDateColumn = document.getElementById("birth-date-column");
    const addressColumn = document.getElementById("address-column");
    const clearDetailCard = () => {
        employeeIdColumn.innerHTML = "";
        idNumberColumn.innerHTML = "";
        nameColumn.innerHTML = "";
        titleColumn.innerHTML = "";
        birthPlaceColumn.innerHTML = "";
        birthDateColumn.innerHTML = "";
        addressColumn.innerHTML = "";
    }

    const showEmployeesCard = () => {
        // unhide employees card, hidding employee form
        employeesCard.removeAttribute("hidden");
        employeeFormCard.setAttribute("hidden", true);
        // Also for button
        newEmployeeButton.removeAttribute("hidden");
        cancelButton.setAttribute("hidden", true);

        // Remove Button Submit
        buttonSubmitForm.innerHTML = "";
    }

    const showEmployeeForm = () => {
        // unhide employee form, hidding employees card
        employeesCard.setAttribute("hidden", true);
        employeeFormCard.removeAttribute("hidden");
        // Also for button
        newEmployeeButton.setAttribute("hidden", true);
        cancelButton.removeAttribute("hidden");

        // Clear the forms
        clearForm(); 
    }

    const editEmployee = () => {    
        showEmployeeForm();

        buttonSubmitForm.innerHTML = `<button type="submit" class="btn btn-primary" id="submit-edit">Save</button>`;
    }

    const showEmpoyeeDetailCard = () => {
        employeeDetailCard.removeAttribute("hidden", true);
        employeeFormCard.setAttribute("hidden", true);
        employeesCard.setAttribute("hidden", true);

        newEmployeeButton.setAttribute("hidden", true);
        cancelButton.setAttribute("hidden", true);
        returnButton.removeAttribute("hidden");
    }

    // Events
    newEmployeeButton.addEventListener("click", (e) => {
        e.preventDefault();

        showEmployeeForm();
        // Create Button
        buttonSubmitForm.innerHTML = `<button type="submit" class="btn btn-primary" id="submit-new">Submit</button>`;
    });
    cancelButton.addEventListener("click", (e) => {
        e.preventDefault();

        // Clearing Form
        if (idNumberForm.value !== "") {
            Swal.fire({
                title: "are you sure wanna cancel it?",
                // text: "You won't be able to revert this!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes!"
            }).then(results => {
                if (results.isConfirmed) {
                    showEmployeesCard();
                    return 0;
                }
            });
        } else {
            showEmployeesCard();
        }
    });
    returnButton.addEventListener("click", (e) => {
        e.preventDefault();

        employeesCard.removeAttribute("hidden");
        employeeDetailCard.setAttribute('hidden', true);

        newEmployeeButton.removeAttribute("hidden");
        returnButton.setAttribute("hidden", true);

        clearDetailCard();
    })
</script>